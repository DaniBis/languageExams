(()=>{var e={};e.id=698,e.ids=[698],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},6005:e=>{"use strict";e.exports=require("node:crypto")},5304:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.Z,__next_app__:()=>u,originalPathname:()=>c,pages:()=>d,routeModule:()=>m,tree:()=>l}),r(2916),r(8307),r(6083),r(5866);var a=r(3191),s=r(8716),i=r(8001),n=r(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(t,o);let l=["",{children:["admin",{children:["schedule",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2916)),"/Users/ovidiuban/languageExams/app/admin/schedule/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,8307)),"/Users/ovidiuban/languageExams/app/layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,6083)),"/Users/ovidiuban/languageExams/app/error.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/ovidiuban/languageExams/app/admin/schedule/page.tsx"],c="/admin/schedule/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/schedule/page",pathname:"/admin/schedule",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},6122:(e,t,r)=>{Promise.resolve().then(r.bind(r,2531))},2531:(e,t,r)=>{"use strict";r.d(t,{AdminScheduleManager:()=>y});var a=r(326),s=r(7577),i=r(772),n=r(7863);let o=["Europe/Bucharest","UTC","Europe/London","America/New_York","America/Los_Angeles","Asia/Bangkok"],l=[7,14,21,28,31],d="en-GB",c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u=Array.from({length:30},(e,t)=>420+30*t),m=[30,60,90,120,150,180];function x(e){return new Intl.DateTimeFormat(d,{weekday:"short",month:"short",day:"numeric"}).format(e)}function g(e,t){return new Intl.DateTimeFormat(d,{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:t}).format(e)}function p(e){return`${String(Math.floor(e/60)).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`}function h(e,t){return`${p(e)} – ${p(e+t)}`}function y({adminKey:e,initialSlots:t,initialStartDate:r,initialDays:d,initialRecurringLocks:y}){let[f,b]=(0,s.useState)(t),[w,k]=(0,s.useState)(r),[N,v]=(0,s.useState)(d),[j,S]=(0,s.useState)("Europe/Bucharest"),[T,E]=(0,s.useState)(""),[M,D]=(0,s.useState)([]),[C,_]=(0,s.useState)([]),[U,A]=(0,s.useState)(null),[O,R]=(0,s.useState)(!1),[I,P]=(0,s.useState)(null),[L,B]=(0,s.useState)(y),[K,F]=(0,s.useState)(!1),[H,q]=(0,s.useState)({weekday:0,startMinutes:420,durationMinutes:60,note:""}),z=(0,s.useMemo)(()=>f.reduce((e,t)=>{let r=new Date(t.start).toDateString();return e[r]=e[r]?[...e[r],t]:[t],e},{}),[f]),G=(0,s.useMemo)(()=>Object.keys(z).map(e=>({key:e,date:new Date(e)})).sort((e,t)=>e.date.getTime()-t.date.getTime()),[z]),$=(0,s.useMemo)(()=>f.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{available:0,booked:0,locked:0}),[f]),Y=(0,s.useMemo)(()=>m.filter(e=>H.startMinutes+e<=1320),[H.startMinutes]),J=(0,s.useMemo)(()=>[...L].sort((e,t)=>e.weekday-t.weekday||e.startMinutes-t.startMinutes),[L]),V=(0,s.useCallback)(async()=>{try{R(!0);let t=new URLSearchParams;if(w){let e=new Date(w);Number.isNaN(e.getTime())||t.set("start",e.toISOString())}t.set("days",String(N));let r=await fetch(`/api/schedule?${t.toString()}`);if(!r.ok)throw Error("Failed to load slots.");let a=await r.json();b(a.slots);let s=await fetch("/api/admin/schedule",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":e},body:JSON.stringify({action:"list-recurring"})});if(s.ok){let e=await s.json();Array.isArray(e.recurringLocks)&&B(e.recurringLocks)}A(null)}catch(e){A({type:"error",message:e.message})}finally{R(!1)}},[e,N,w]),W=e=>{if("recurring"===e.lockType){A({type:"error",message:"Recurring locks are managed below. Remove them from the Weekly locks panel."});return}if("available"===e.status){D(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),_(t=>t.filter(t=>t!==e.id)),A(null);return}"locked"===e.status&&(_(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),D(t=>t.filter(t=>t!==e.id)),A(null))},Z=async(t,r)=>{if(!r.length){A({type:"error",message:"Select at least one slot first."});return}try{P(t);let a=await fetch("/api/admin/schedule",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":e},body:JSON.stringify({action:t,slotIds:r,note:"lock"===t?T:void 0})});if(!a.ok){let e=await a.json();throw Error(e.error||"Action failed.")}A({type:"success",message:"lock"===t?"Slots locked.":"Slots unlocked."}),E("lock"===t?"":T),D([]),_([]),await V()}catch(e){A({type:"error",message:e.message})}finally{P(null)}},X=(0,s.useMemo)(()=>f.filter(e=>M.includes(e.id)),[M,f]),Q=(0,s.useMemo)(()=>f.filter(e=>C.includes(e.id)),[C,f]),ee=async t=>{t.preventDefault();try{F(!0);let t=await fetch("/api/admin/schedule",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":e},body:JSON.stringify({action:"add-recurring",...H})}),r=await t.json();if(!t.ok)throw Error(r.error||"Failed to create recurring lock.");B(r.recurringLocks),A({type:"success",message:"Recurring lock saved."}),q(e=>({...e,note:""})),await V()}catch(e){A({type:"error",message:e.message})}finally{F(!1)}},et=async t=>{try{F(!0);let r=await fetch("/api/admin/schedule",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":e},body:JSON.stringify({action:"remove-recurring",recurringLockId:t})}),a=await r.json();if(!r.ok)throw Error(a.error||"Failed to remove recurring lock.");B(a.recurringLocks),A({type:"success",message:"Recurring lock removed."}),await V()}catch(e){A({type:"error",message:e.message})}finally{F(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"rounded-3xl border border-white/70 bg-white/80 p-6 shadow-sm",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Available"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:$.available})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Booked"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:$.booked})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Locked"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:$.locked})]}),(0,a.jsxs)("div",{className:"ml-auto flex flex-wrap items-center gap-3 text-sm text-gray-600",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"h-3 w-3 rounded-full bg-white border"})," Free"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-300"})," Booked"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"h-3 w-3 rounded-full bg-amber-300"})," Manual lock"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"h-3 w-3 rounded-full bg-purple-300"})," Recurring lock"]})]})]})}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Start date",a.jsx("input",{type:"date",className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm",value:w,onChange:e=>k(e.target.value)})]}),(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Days",a.jsx("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:N,onChange:e=>v(Number(e.target.value)||d),children:l.map(e=>a.jsx("option",{value:e,children:e},e))})]}),(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Timezone",a.jsx("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:j,onChange:e=>S(e.target.value),children:o.map(e=>a.jsx("option",{value:e,children:e},e))})]}),a.jsx(i.z,{type:"button",variant:"outline",onClick:V,disabled:O,children:O?"Refreshing…":"Refresh"})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 xl:grid-cols-7 gap-3 min-w-full",children:G.map(({key:e,date:t})=>(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-100 bg-white shadow-sm",children:[a.jsx("div",{className:"border-b border-gray-100 px-4 py-3",children:a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:x(t)})}),a.jsx("div",{className:"max-h-[480px] overflow-y-auto divide-y divide-gray-100",children:z[e]?.sort((e,t)=>new Date(e.start).getTime()-new Date(t.start).getTime()).map(e=>{let t=new Date(e.start),r=new Date(e.end),s=M.includes(e.id),i=C.includes(e.id);return a.jsxs("button",{type:"button",onClick:()=>W(e),className:n.cn("w-full text-left px-4 py-3 text-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","booked"===e.status&&"bg-gray-100 text-gray-400 cursor-not-allowed","locked"===e.status&&"recurring"!==e.lockType&&"bg-amber-50 text-amber-700","locked"===e.status&&"recurring"===e.lockType&&"bg-purple-50 text-purple-700 cursor-not-allowed","available"===e.status&&"hover:bg-soft-blue-light/30 text-gray-800",s&&"ring-2 ring-soft-blue bg-soft-blue/20",i&&"ring-2 ring-amber-500"),disabled:"booked"===e.status||"recurring"===e.lockType,children:[a.jsxs("p",{className:"font-medium",children:[g(t,j)," – ",g(r,j)]}),a.jsx("p",{className:"text-xs text-gray-600 capitalize",children:"locked"===e.status?"recurring"===e.lockType?"Recurring lock":"Locked":e.status}),e.lockNote&&a.jsx("p",{className:"text-xs text-gray-500",children:e.lockNote})]},e.id)})})]},e))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-4 rounded-3xl border border-white/70 bg-white/90 p-5 shadow-lg",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Ready to lock"}),a.jsx("p",{className:"text-sm text-gray-600",children:X.length||"None selected"}),a.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto space-y-1 text-sm text-gray-700",children:X.map(e=>(0,a.jsxs)("p",{children:[x(new Date(e.start))," \xb7 ",g(new Date(e.start),j)]},e.id))})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Ready to unlock"}),a.jsx("p",{className:"text-sm text-gray-600",children:Q.length||"None selected"}),a.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto space-y-1 text-sm text-gray-700",children:Q.map(e=>(0,a.jsxs)("p",{children:[x(new Date(e.start))," \xb7 ",g(new Date(e.start),j)]},e.id))})]}),a.jsx("div",{children:(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Internal note (optional)",a.jsx("textarea",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm",rows:3,placeholder:"Blocked for exam week, travel, etc.",value:T,onChange:e=>E(e.target.value)})]})}),U&&a.jsx("div",{className:(0,n.cn)("rounded-xl px-3 py-2 text-sm","error"===U.type?"bg-red-50 text-red-600":"bg-green-50 text-green-700"),children:U.message}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(i.z,{type:"button",className:"w-full rounded-2xl bg-soft-blue text-white",disabled:"lock"===I||!X.length,onClick:()=>Z("lock",M),children:"lock"===I?"Locking…":"Lock selected slots"}),a.jsx(i.z,{type:"button",variant:"outline",className:"w-full rounded-2xl border-amber-500 text-amber-600",disabled:"unlock"===I||!Q.length,onClick:()=>Z("unlock",C),children:"unlock"===I?"Unlocking…":"Unlock selected slots"})]})]}),(0,a.jsxs)("div",{className:"space-y-4 rounded-3xl border border-white/70 bg-white/90 p-5 shadow-lg",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Weekly locks"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Automatically repeat blocks (e.g. Thursdays 19:00–20:00)."})]}),(0,a.jsxs)("form",{className:"space-y-3",onSubmit:ee,children:[(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Weekday",a.jsx("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:H.weekday,onChange:e=>q(t=>({...t,weekday:Number(e.target.value)||0})),children:c.map((e,t)=>a.jsx("option",{value:t,children:e},e))})]}),(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Start time",a.jsx("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:H.startMinutes,onChange:e=>{let t=Number(e.target.value);q(e=>{let r={...e,startMinutes:t};return r.startMinutes+r.durationMinutes>1320&&(r.durationMinutes=30),r})},children:u.map(e=>a.jsx("option",{value:e,children:p(e)},e))})]}),(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Duration",a.jsx("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:H.durationMinutes,onChange:e=>q(t=>({...t,durationMinutes:Number(e.target.value)||30})),children:Y.map(e=>(0,a.jsxs)("option",{value:e,children:[e," min (",h(H.startMinutes,e),")"]},e))})]}),(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Internal note (optional)",a.jsx("textarea",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm",rows:2,placeholder:"Blocked for lessons, commute, etc.",value:H.note,onChange:e=>q(t=>({...t,note:e.target.value}))})]}),a.jsx(i.z,{type:"submit",className:"w-full rounded-2xl bg-soft-blue text-white",disabled:K,children:K?"Saving…":"Save weekly lock"})]}),a.jsx("div",{className:"space-y-2 max-h-56 overflow-y-auto",children:0===J.length?a.jsx("p",{className:"text-sm text-gray-600",children:"No recurring locks yet."}):J.map(e=>(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 rounded-2xl border border-gray-100 px-3 py-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-semibold text-gray-900",children:[c[e.weekday]," \xb7 ",h(e.startMinutes,e.durationMinutes)]}),e.note&&a.jsx("p",{className:"text-xs text-gray-600",children:e.note})]}),a.jsx(i.z,{type:"button",variant:"outline",size:"sm",className:"rounded-xl border-gray-200 text-gray-700",onClick:()=>et(e.id),disabled:K,children:"Remove"})]},e.id))})]})]})]})]})}},2916:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(9510);let s=(0,r(8570).createProxy)(String.raw`/Users/ovidiuban/languageExams/components/sections/admin-schedule-manager.tsx#AdminScheduleManager`);var i=r(9882);async function n({searchParams:e}){let t=e||{},r=process.env.SCHEDULE_ADMIN_KEY;if(!r)return a.jsx("section",{className:"container max-w-3xl mx-auto py-20 px-6",children:a.jsx("p",{className:"text-red-600 font-semibold",children:"Please set SCHEDULE_ADMIN_KEY in your environment."})});let n=Array.isArray(t.key)?t.key[0]:t.key;if(n!==r)return(0,a.jsxs)("section",{className:"container max-w-3xl mx-auto py-20 px-6",children:[a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Unauthorized."}),a.jsx("p",{className:"text-gray-600",children:"Provide ?key=YOUR_KEY in the URL to view bookings."})]});let o=(await (0,i.aL)()).sort((e,t)=>new Date(e.start).getTime()-new Date(t.start).getTime()),l=new Date,d=l.toISOString().split("T")[0],c=await (0,i.C9)({startDate:l.toISOString(),days:14}),u=await (0,i.G7)();return(0,a.jsxs)("section",{className:"container mx-auto max-w-6xl py-16 px-6 space-y-10",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm uppercase tracking-wide text-soft-blue font-semibold",children:"Admin tools"}),a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Manage schedule locks"}),a.jsx("p",{className:"text-gray-600",children:"Lock slots before vacations or exams, or unlock them when plans change. Data visible only with the correct key."})]}),a.jsx(s,{adminKey:n||r,initialSlots:c,initialStartDate:d,initialDays:14,initialRecurringLocks:u}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Upcoming bookings"}),a.jsx("p",{className:"text-gray-600",children:"Chronological list of everything currently reserved."})]}),0===o.length?a.jsx("p",{className:"rounded-2xl border border-gray-200 bg-white/80 p-4 text-sm text-gray-600",children:"No bookings yet. Slots will appear here as soon as they are reserved."}):a.jsx("div",{className:"space-y-4",children:o.map(e=>(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-200 p-4 bg-white/80",children:[a.jsx("p",{className:"text-sm text-gray-500",children:new Date(e.start).toLocaleString()}),a.jsx("p",{className:"font-semibold text-gray-900",children:e.bookedByName}),a.jsx("p",{className:"text-sm text-gray-700",children:e.bookedByEmail}),e.bookingType&&(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:["Booking: ",e.bookingType]}),e.note&&(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Note: ",e.note]})]},e.id))})]})]})}},9882:(e,t,r)=>{"use strict";r.d(t,{vL:()=>M,CB:()=>j,aL:()=>v,G7:()=>E,C9:()=>N,Yj:()=>S,U6:()=>D,hy:()=>T});var a=r(2048),s=r(5315),i=r.n(s),n=r(7786);let o=i().join(process.cwd(),"data","schedule.json"),l=i().join(process.cwd(),"data","recurring-locks.json"),d=function(){if(!(process.env.UPSTASH_REDIS_REST_URL&&process.env.UPSTASH_REDIS_REST_TOKEN||process.env.KV_REST_API_URL&&process.env.KV_REST_API_TOKEN))return null;try{return n.s.fromEnv()}catch(e){return console.error("Failed to initialize KV client. Falling back to filesystem storage.",e),null}}(),c=process.env.SCHEDULE_KV_BOOKINGS_KEY??"schedule:bookings",u=process.env.SCHEDULE_KV_RECURRING_KEY??"schedule:recurring-locks";async function m(){await a.promises.mkdir(i().dirname(o),{recursive:!0});try{await a.promises.access(o)}catch{await a.promises.writeFile(o,"[]","utf8")}}async function x(){await a.promises.mkdir(i().dirname(l),{recursive:!0});try{await a.promises.access(l)}catch{await a.promises.writeFile(l,"[]","utf8")}}function g(e){return"object"==typeof e&&null!==e&&"DYNAMIC_SERVER_USAGE"===e.digest}async function p(e){if(!d)return null;try{let t=await d.get(e);if(!t)return null;return t}catch(t){return g(t)||console.error(`KV read failed for ${e}`,t),null}}async function h(e,t){if(!d)return!1;try{return await d.set(e,t),!0}catch(t){return g(t)||console.error(`KV write failed for ${e}`,t),!1}}async function y(){let e=await p(c)??await (async()=>{await m();let e=await a.promises.readFile(o,"utf8");return e.trim()?JSON.parse(e):[]})(),t=Array.isArray(e)?e:[];return Array.isArray(t)?t.map(e=>({...e,entryType:"admin-lock"===e.entryType?"admin-lock":"user"})):[]}async function f(e){await h(c,e)||(await m(),await a.promises.writeFile(o,JSON.stringify(e,null,2),"utf8"))}async function b(){let e=await p(u)??await (async()=>{await x();let e=await a.promises.readFile(l,"utf8");return e.trim()?JSON.parse(e):[]})(),t=Array.isArray(e)?e:[];return Array.isArray(t)?t.map(e=>({id:String(e.id),weekday:Number(e.weekday),startMinutes:Number(e.startMinutes),durationMinutes:Number(e.durationMinutes),note:e.note?String(e.note):void 0})).filter(e=>!Number.isNaN(e.weekday)&&!Number.isNaN(e.startMinutes)&&!Number.isNaN(e.durationMinutes)):[]}async function w(e){await h(u,e)||(await x(),await a.promises.writeFile(l,JSON.stringify(e,null,2),"utf8"))}function k(e,t){if(e.getUTCDay()!==t.weekday)return!1;let r=60*e.getUTCHours()+e.getUTCMinutes();return r>=t.startMinutes&&r<t.startMinutes+t.durationMinutes}async function N({startDate:e,days:t}={}){let r=new Map((await y()).map(e=>[e.id,e])),a=await b(),s=e?new Date(e):new Date;return Number.isNaN(s.getTime())&&(s=new Date),(function(e,t){let r=[];for(let a=0;a<t;a++){let t=new Date(e);t.setUTCDate(e.getUTCDate()+a);for(let e=7;e<22;e++)for(let a=0;a<60;a+=30){let s=new Date(t);s.setUTCHours(e,a,0,0);let i=new Date(s);i.setUTCMinutes(s.getUTCMinutes()+30),r.push({id:s.toISOString(),start:s.toISOString(),end:i.toISOString(),status:"available"})}}return r})(function(e){let t=new Date(e);return t.setUTCHours(0,0,0,0),t}(s),Math.min(Math.max(t??7,1),31)).map(e=>{let t=r.get(e.id);if(t){let r="admin-lock"===t.entryType?"locked":"booked";return{...e,status:r,lockType:"admin-lock"===t.entryType?"manual":void 0,lockNote:"admin-lock"===t.entryType?t.bookingType:void 0}}let s=new Date(e.start),i=a.find(e=>k(s,e));return i?{...e,status:"locked",lockType:"recurring",lockNote:i.note,recurringLockId:i.id}:e})}async function v(){return y()}async function j(e,{name:t,email:r,note:a,bookingType:s}){if(!e.length)throw Error("No slot ids provided.");let i=await y(),n=new Map(i.map(e=>[e.id,e])),o=await b(),l=[];for(let d of e){if(n.has(d))throw Error("One or more slots have just been booked by another student.");let e=new Date(d);if(Number.isNaN(e.getTime()))throw Error("Invalid slot selected.");if(e.getUTCMinutes()%30!=0)throw Error("Slot is not aligned to the 30-minute grid.");let c=e.getUTCHours();if(c<7||c>=22)throw Error("Slot is outside of bookable hours.");if(function(e,t){return t.some(t=>k(e,t))}(e,o))throw Error("This slot is blocked by the tutor. Please pick another time.");let u=new Date(e);u.setUTCMinutes(e.getUTCMinutes()+30);let m={id:d,start:e.toISOString(),end:u.toISOString(),bookedByName:t,bookedByEmail:r,bookingType:s?.trim()||void 0,note:a,bookedAt:new Date().toISOString(),entryType:"user"};i.push(m),n.set(d,m),l.push({id:d,start:m.start,end:m.end,status:"booked"})}return await f(i),l}async function S(e,{note:t,adminLabel:r}={}){if(!e.length)throw Error("No slot ids provided for locking.");let a=await y(),s=new Map(a.map(e=>[e.id,e]));for(let i of e){if(s.has(i))throw Error("One or more selected slots are already booked or locked.");let e=new Date(i);if(Number.isNaN(e.getTime()))throw Error("Invalid slot selected for locking.");if(e.getUTCMinutes()%30!=0)throw Error("Slot is not aligned to the 30-minute grid.");let n=e.getUTCHours();if(n<7||n>=22)throw Error("Slot is outside of bookable hours.");let o=new Date(e);o.setUTCMinutes(e.getUTCMinutes()+30);let l={id:i,start:e.toISOString(),end:o.toISOString(),bookedByName:r||"Admin Hold",bookedByEmail:"admin@englishwithdaniel.com",bookingType:t?.trim()||void 0,bookedAt:new Date().toISOString(),entryType:"admin-lock"};a.push(l),s.set(i,l)}await f(a)}async function T(e){if(!e.length)throw Error("No slot ids provided for unlocking.");let t=await y(),r=new Set(e),a=t.filter(e=>!("admin-lock"===e.entryType&&r.has(e.id)));await f(a)}async function E(){return b()}async function M(e){let{weekday:t,startMinutes:r,durationMinutes:a,note:s}=e;if(!Number.isInteger(t)||t<0||t>6)throw Error("Weekday must be between 0 (Sunday) and 6 (Saturday).");if(r%30!=0)throw Error("Start time must align with the 30-minute grid.");if(a<30||a%30!=0)throw Error("Duration must be in 30-minute increments.");if(r<420||r>=1320)throw Error("Start time is outside of bookable hours.");if(r+a>1320)throw Error("Recurring lock exceeds the bookable day range.");let i=await b(),n={id:`${t}-${r}-${Date.now()}`,weekday:t,startMinutes:r,durationMinutes:a,note:s?.trim()||void 0};return i.push(n),await w(i),i}async function D(e){let t=(await b()).filter(t=>t.id!==e);return await w(t),t}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,842,786,979],()=>r(5304));module.exports=a})();