(()=>{var e={};e.id=698,e.ids=[698],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2048:e=>{"use strict";e.exports=require("fs")},5315:e=>{"use strict";e.exports=require("path")},5304:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.Z,__next_app__:()=>m,originalPathname:()=>c,pages:()=>d,routeModule:()=>u,tree:()=>o}),s(2916),s(8307),s(6083),s(5866);var a=s(3191),r=s(8716),i=s(8001),n=s(5231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(t,l);let o=["",{children:["admin",{children:["schedule",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2916)),"/Users/ovidiuban/languageExams/app/admin/schedule/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,8307)),"/Users/ovidiuban/languageExams/app/layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,6083)),"/Users/ovidiuban/languageExams/app/error.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/ovidiuban/languageExams/app/admin/schedule/page.tsx"],c="/admin/schedule/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/schedule/page",pathname:"/admin/schedule",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},6122:(e,t,s)=>{Promise.resolve().then(s.bind(s,2706))},2706:(e,t,s)=>{"use strict";s.d(t,{AdminScheduleManager:()=>u});var a=s(326),r=s(7577),i=s(772),n=s(7863);let l=["Europe/Bucharest","UTC","Europe/London","America/New_York","America/Los_Angeles","Asia/Bangkok"],o=[7,14,21,28,31],d="en-GB";function c(e){return new Intl.DateTimeFormat(d,{weekday:"short",month:"short",day:"numeric"}).format(e)}function m(e,t){return new Intl.DateTimeFormat(d,{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:t}).format(e)}function u({adminKey:e,initialSlots:t,initialStartDate:s,initialDays:d}){let[u,x]=(0,r.useState)(t),[g,p]=(0,r.useState)(s),[h,y]=(0,r.useState)(d),[b,f]=(0,r.useState)("Europe/Bucharest"),[w,N]=(0,r.useState)(""),[v,j]=(0,r.useState)([]),[k,S]=(0,r.useState)([]),[D,T]=(0,r.useState)(null),[E,C]=(0,r.useState)(!1),[U,M]=(0,r.useState)(null),A=(0,r.useMemo)(()=>u.reduce((e,t)=>{let s=new Date(t.start).toDateString();return e[s]=e[s]?[...e[s],t]:[t],e},{}),[u]),_=(0,r.useMemo)(()=>Object.keys(A).map(e=>({key:e,date:new Date(e)})).sort((e,t)=>e.date.getTime()-t.date.getTime()),[A]),O=(0,r.useMemo)(()=>u.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{available:0,booked:0,locked:0}),[u]),P=(0,r.useCallback)(async()=>{try{C(!0);let e=new URLSearchParams;if(g){let t=new Date(g);Number.isNaN(t.getTime())||e.set("start",t.toISOString())}e.set("days",String(h));let t=await fetch(`/api/schedule?${e.toString()}`);if(!t.ok)throw Error("Failed to load slots.");let s=await t.json();x(s.slots),T(null)}catch(e){T({type:"error",message:e.message})}finally{C(!1)}},[h,g]),I=e=>{if("available"===e.status){j(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),S(t=>t.filter(t=>t!==e.id)),T(null);return}"locked"===e.status&&(S(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),j(t=>t.filter(t=>t!==e.id)),T(null))},B=async(t,s)=>{if(!s.length){T({type:"error",message:"Select at least one slot first."});return}try{M(t);let a=await fetch("/api/admin/schedule",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":e},body:JSON.stringify({action:t,slotIds:s,note:"lock"===t?w:void 0})});if(!a.ok){let e=await a.json();throw Error(e.error||"Action failed.")}T({type:"success",message:"lock"===t?"Slots locked.":"Slots unlocked."}),N("lock"===t?"":w),j([]),S([]),await P()}catch(e){T({type:"error",message:e.message})}finally{M(null)}},L=(0,r.useMemo)(()=>u.filter(e=>v.includes(e.id)),[v,u]),q=(0,r.useMemo)(()=>u.filter(e=>k.includes(e.id)),[k,u]);return(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"rounded-3xl border border-white/70 bg-white/80 p-6 shadow-sm",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Available"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:O.available})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Booked"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:O.booked})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Locked"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:O.locked})]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"h-3 w-3 rounded-full bg-white border"})," Free"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"h-3 w-3 rounded-full bg-gray-300"})," Booked"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"h-3 w-3 rounded-full bg-amber-300"})," Locked"]})]})]})}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Start date",a.jsx("input",{type:"date",className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm",value:g,onChange:e=>p(e.target.value)})]}),(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Days",a.jsx("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:h,onChange:e=>y(Number(e.target.value)||d),children:o.map(e=>a.jsx("option",{value:e,children:e},e))})]}),(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Timezone",a.jsx("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:b,onChange:e=>f(e.target.value),children:l.map(e=>a.jsx("option",{value:e,children:e},e))})]}),a.jsx(i.z,{type:"button",variant:"outline",onClick:P,disabled:E,children:E?"Refreshing…":"Refresh"})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 xl:grid-cols-7 gap-3 min-w-full",children:_.map(({key:e,date:t})=>(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-100 bg-white shadow-sm",children:[a.jsx("div",{className:"border-b border-gray-100 px-4 py-3",children:a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:c(t)})}),a.jsx("div",{className:"max-h-[480px] overflow-y-auto divide-y divide-gray-100",children:A[e]?.sort((e,t)=>new Date(e.start).getTime()-new Date(t.start).getTime()).map(e=>{let t=new Date(e.start),s=new Date(e.end),r=v.includes(e.id),i=k.includes(e.id);return a.jsxs("button",{type:"button",onClick:()=>I(e),className:n.cn("w-full text-left px-4 py-3 text-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","booked"===e.status&&"bg-gray-100 text-gray-400 cursor-not-allowed","locked"===e.status&&"bg-amber-50 text-amber-700","available"===e.status&&"hover:bg-soft-blue-light/30 text-gray-800",r&&"ring-2 ring-soft-blue bg-soft-blue/20",i&&"ring-2 ring-amber-500"),disabled:"booked"===e.status,children:[a.jsxs("p",{className:"font-medium",children:[m(t,b)," – ",m(s,b)]}),a.jsx("p",{className:"text-xs text-gray-600 capitalize",children:e.status})]},e.id)})})]},e))})]}),(0,a.jsxs)("div",{className:"space-y-4 rounded-3xl border border-white/70 bg-white/90 p-5 shadow-lg",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Ready to lock"}),a.jsx("p",{className:"text-sm text-gray-600",children:L.length||"None selected"}),a.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto space-y-1 text-sm text-gray-700",children:L.map(e=>(0,a.jsxs)("p",{children:[c(new Date(e.start))," \xb7 ",m(new Date(e.start),b)]},e.id))})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Ready to unlock"}),a.jsx("p",{className:"text-sm text-gray-600",children:q.length||"None selected"}),a.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto space-y-1 text-sm text-gray-700",children:q.map(e=>(0,a.jsxs)("p",{children:[c(new Date(e.start))," \xb7 ",m(new Date(e.start),b)]},e.id))})]}),a.jsx("div",{children:(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Internal note (optional)",a.jsx("textarea",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm",rows:3,placeholder:"Blocked for exam week, travel, etc.",value:w,onChange:e=>N(e.target.value)})]})}),D&&a.jsx("div",{className:(0,n.cn)("rounded-xl px-3 py-2 text-sm","error"===D.type?"bg-red-50 text-red-600":"bg-green-50 text-green-700"),children:D.message}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(i.z,{type:"button",className:"w-full rounded-2xl bg-soft-blue text-white",disabled:"lock"===U||!L.length,onClick:()=>B("lock",v),children:"lock"===U?"Locking…":"Lock selected slots"}),a.jsx(i.z,{type:"button",variant:"outline",className:"w-full rounded-2xl border-amber-500 text-amber-600",disabled:"unlock"===U||!q.length,onClick:()=>B("unlock",k),children:"unlock"===U?"Unlocking…":"Unlock selected slots"})]})]})]})]})}},2916:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(9510);let r=(0,s(8570).createProxy)(String.raw`/Users/ovidiuban/languageExams/components/sections/admin-schedule-manager.tsx#AdminScheduleManager`);var i=s(8827);async function n({searchParams:e}){let t=e||{},s=process.env.SCHEDULE_ADMIN_KEY;if(!s)return a.jsx("section",{className:"container max-w-3xl mx-auto py-20 px-6",children:a.jsx("p",{className:"text-red-600 font-semibold",children:"Please set SCHEDULE_ADMIN_KEY in your environment."})});let n=Array.isArray(t.key)?t.key[0]:t.key;if(n!==s)return(0,a.jsxs)("section",{className:"container max-w-3xl mx-auto py-20 px-6",children:[a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Unauthorized."}),a.jsx("p",{className:"text-gray-600",children:"Provide ?key=YOUR_KEY in the URL to view bookings."})]});let l=(await (0,i.aL)()).sort((e,t)=>new Date(e.start).getTime()-new Date(t.start).getTime()),o=new Date,d=o.toISOString().split("T")[0],c=await (0,i.C9)({startDate:o.toISOString(),days:14});return(0,a.jsxs)("section",{className:"container mx-auto max-w-6xl py-16 px-6 space-y-10",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm uppercase tracking-wide text-soft-blue font-semibold",children:"Admin tools"}),a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Manage schedule locks"}),a.jsx("p",{className:"text-gray-600",children:"Lock slots before vacations or exams, or unlock them when plans change. Data visible only with the correct key."})]}),a.jsx(r,{adminKey:n||s,initialSlots:c,initialStartDate:d,initialDays:14}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Upcoming bookings"}),a.jsx("p",{className:"text-gray-600",children:"Chronological list of everything currently reserved."})]}),0===l.length?a.jsx("p",{className:"rounded-2xl border border-gray-200 bg-white/80 p-4 text-sm text-gray-600",children:"No bookings yet. Slots will appear here as soon as they are reserved."}):a.jsx("div",{className:"space-y-4",children:l.map(e=>(0,a.jsxs)("div",{className:"rounded-2xl border border-gray-200 p-4 bg-white/80",children:[a.jsx("p",{className:"text-sm text-gray-500",children:new Date(e.start).toLocaleString()}),a.jsx("p",{className:"font-semibold text-gray-900",children:e.bookedByName}),a.jsx("p",{className:"text-sm text-gray-700",children:e.bookedByEmail}),e.bookingType&&(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:["Booking: ",e.bookingType]}),e.note&&(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Note: ",e.note]})]},e.id))})]})]})}},8827:(e,t,s)=>{"use strict";s.d(t,{C9:()=>c,CB:()=>u,Yj:()=>x,aL:()=>m,hy:()=>g});var a=s(2048),r=s(5315),i=s.n(r);let n=i().join(process.cwd(),"data","schedule.json");async function l(){await a.promises.mkdir(i().dirname(n),{recursive:!0});try{await a.promises.access(n)}catch{await a.promises.writeFile(n,"[]","utf8")}}async function o(){await l();let e=await a.promises.readFile(n,"utf8"),t=e.trim()?JSON.parse(e):[];return Array.isArray(t)?t.map(e=>({...e,entryType:"admin-lock"===e.entryType?"admin-lock":"user"})):[]}async function d(e){await l(),await a.promises.writeFile(n,JSON.stringify(e,null,2),"utf8")}async function c({startDate:e,days:t}={}){let s=new Map((await o()).map(e=>[e.id,e])),a=e?new Date(e):new Date;return Number.isNaN(a.getTime())&&(a=new Date),(function(e,t){let s=[];for(let a=0;a<t;a++){let t=new Date(e);t.setUTCDate(e.getUTCDate()+a);for(let e=7;e<22;e++)for(let a=0;a<60;a+=30){let r=new Date(t);r.setUTCHours(e,a,0,0);let i=new Date(r);i.setUTCMinutes(r.getUTCMinutes()+30),s.push({id:r.toISOString(),start:r.toISOString(),end:i.toISOString(),status:"available"})}}return s})(function(e){let t=new Date(e);return t.setUTCHours(0,0,0,0),t}(a),Math.min(Math.max(t??7,1),31)).map(e=>{let t=s.get(e.id);if(!t)return e;let a="admin-lock"===t.entryType?"locked":"booked";return{...e,status:a}})}async function m(){return o()}async function u(e,{name:t,email:s,note:a,bookingType:r}){if(!e.length)throw Error("No slot ids provided.");let i=await o(),n=new Map(i.map(e=>[e.id,e])),l=[];for(let o of e){if(n.has(o))throw Error("One or more slots have just been booked by another student.");let e=new Date(o);if(Number.isNaN(e.getTime()))throw Error("Invalid slot selected.");if(e.getUTCMinutes()%30!=0)throw Error("Slot is not aligned to the 30-minute grid.");let d=e.getUTCHours();if(d<7||d>=22)throw Error("Slot is outside of bookable hours.");let c=new Date(e);c.setUTCMinutes(e.getUTCMinutes()+30);let m={id:o,start:e.toISOString(),end:c.toISOString(),bookedByName:t,bookedByEmail:s,bookingType:r?.trim()||void 0,note:a,bookedAt:new Date().toISOString(),entryType:"user"};i.push(m),n.set(o,m),l.push({id:o,start:m.start,end:m.end,status:"booked"})}return await d(i),l}async function x(e,{note:t,adminLabel:s}={}){if(!e.length)throw Error("No slot ids provided for locking.");let a=await o(),r=new Map(a.map(e=>[e.id,e]));for(let i of e){if(r.has(i))throw Error("One or more selected slots are already booked or locked.");let e=new Date(i);if(Number.isNaN(e.getTime()))throw Error("Invalid slot selected for locking.");if(e.getUTCMinutes()%30!=0)throw Error("Slot is not aligned to the 30-minute grid.");let n=e.getUTCHours();if(n<7||n>=22)throw Error("Slot is outside of bookable hours.");let l=new Date(e);l.setUTCMinutes(e.getUTCMinutes()+30);let o={id:i,start:e.toISOString(),end:l.toISOString(),bookedByName:s||"Admin Hold",bookedByEmail:"admin@englishwithdaniel.com",bookingType:t?.trim()||void 0,bookedAt:new Date().toISOString(),entryType:"admin-lock"};a.push(o),r.set(i,o)}await d(a)}async function g(e){if(!e.length)throw Error("No slot ids provided for unlocking.");let t=await o(),s=new Set(e),a=t.filter(e=>!("admin-lock"===e.entryType&&s.has(e.id)));await d(a)}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,842,979],()=>s(5304));module.exports=a})();