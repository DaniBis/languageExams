(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{4341:function(e,t,r){Promise.resolve().then(r.bind(r,6267))},6267:function(e,t,r){"use strict";r.d(t,{AdminScheduleManager:function(){return y}});var s=r(7437),a=r(2265),l=r(2869),n=r(4508);let i=["Europe/Bucharest","UTC","Europe/London","America/New_York","America/Los_Angeles","Asia/Bangkok"],o=[7,14,21,28,31],d="en-GB",c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u=Array.from({length:30},(e,t)=>420+30*t),m=[30,60,90,120,150,180];function x(e){return new Intl.DateTimeFormat(d,{weekday:"short",month:"short",day:"numeric"}).format(e)}function g(e,t){return new Intl.DateTimeFormat(d,{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:t}).format(e)}function p(e){return"".concat(String(Math.floor(e/60)).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0"))}function f(e,t){return"".concat(p(e)," – ").concat(p(e+t))}function y(e){let{adminKey:t,initialSlots:r,initialStartDate:d,initialDays:y,initialRecurringLocks:h}=e,[b,v]=(0,a.useState)(r),[j,w]=(0,a.useState)(d),[k,N]=(0,a.useState)(y),[S,C]=(0,a.useState)("Europe/Bucharest"),[M,T]=(0,a.useState)(""),[D,O]=(0,a.useState)([]),[R,_]=(0,a.useState)([]),[E,A]=(0,a.useState)(null),[z,L]=(0,a.useState)(!1),[B,W]=(0,a.useState)(null),[F,P]=(0,a.useState)(h),[I,$]=(0,a.useState)(!1),[V,J]=(0,a.useState)({weekday:0,startMinutes:420,durationMinutes:60,note:""}),U=(0,a.useMemo)(()=>b.reduce((e,t)=>{let r=new Date(t.start).toDateString();return e[r]=e[r]?[...e[r],t]:[t],e},{}),[b]),Z=(0,a.useMemo)(()=>Object.keys(U).map(e=>({key:e,date:new Date(e)})).sort((e,t)=>e.date.getTime()-t.date.getTime()),[U]),G=(0,a.useMemo)(()=>b.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{available:0,booked:0,locked:0}),[b]),Y=(0,a.useMemo)(()=>m.filter(e=>V.startMinutes+e<=1320),[V.startMinutes]),q=(0,a.useMemo)(()=>[...F].sort((e,t)=>e.weekday-t.weekday||e.startMinutes-t.startMinutes),[F]);(0,a.useEffect)(()=>{O(e=>e.filter(e=>{let t=b.find(t=>t.id===e);return(null==t?void 0:t.status)==="available"})),_(e=>e.filter(e=>{let t=b.find(t=>t.id===e);return(null==t?void 0:t.status)==="locked"&&"recurring"!==t.lockType}))},[b]);let H=(0,a.useCallback)(async()=>{try{L(!0);let e=new URLSearchParams;if(j){let t=new Date(j);Number.isNaN(t.getTime())||e.set("start",t.toISOString())}e.set("days",String(k));let r=await fetch("/api/schedule?".concat(e.toString()));if(!r.ok)throw Error("Failed to load slots.");let s=await r.json();v(s.slots);let a=await fetch("/api/admin/schedule",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":t},body:JSON.stringify({action:"list-recurring"})});if(a.ok){let e=await a.json();Array.isArray(e.recurringLocks)&&P(e.recurringLocks)}A(null)}catch(e){A({type:"error",message:e.message})}finally{L(!1)}},[t,k,j]),K=e=>{if("recurring"===e.lockType){A({type:"error",message:"Recurring locks are managed below. Remove them from the Weekly locks panel."});return}if("available"===e.status){O(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),_(t=>t.filter(t=>t!==e.id)),A(null);return}"locked"===e.status&&(_(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),O(t=>t.filter(t=>t!==e.id)),A(null))},Q=async(e,r)=>{if(!r.length){A({type:"error",message:"Select at least one slot first."});return}try{W(e);let s=await fetch("/api/admin/schedule",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":t},body:JSON.stringify({action:e,slotIds:r,note:"lock"===e?M:void 0})});if(!s.ok){let e=await s.json();throw Error(e.error||"Action failed.")}A({type:"success",message:"lock"===e?"Slots locked.":"Slots unlocked."}),T("lock"===e?"":M),O([]),_([]),await H()}catch(e){A({type:"error",message:e.message})}finally{W(null)}},X=(0,a.useMemo)(()=>b.filter(e=>D.includes(e.id)),[D,b]),ee=(0,a.useMemo)(()=>b.filter(e=>R.includes(e.id)),[R,b]),et=async e=>{e.preventDefault();try{$(!0);let e=await fetch("/api/admin/schedule",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":t},body:JSON.stringify({action:"add-recurring",...V})}),r=await e.json();if(!e.ok)throw Error(r.error||"Failed to create recurring lock.");P(r.recurringLocks),A({type:"success",message:"Recurring lock saved."}),J(e=>({...e,note:""})),await H()}catch(e){A({type:"error",message:e.message})}finally{$(!1)}},er=async e=>{try{$(!0);let r=await fetch("/api/admin/schedule",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":t},body:JSON.stringify({action:"remove-recurring",recurringLockId:e})}),s=await r.json();if(!r.ok)throw Error(s.error||"Failed to remove recurring lock.");P(s.recurringLocks),A({type:"success",message:"Recurring lock removed."}),await H()}catch(e){A({type:"error",message:e.message})}finally{$(!1)}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"rounded-3xl border border-white/70 bg-white/80 p-6 shadow-sm",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Available"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:G.available})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Booked"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:G.booked})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Locked"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:G.locked})]}),(0,s.jsxs)("div",{className:"ml-auto flex flex-wrap items-center gap-3 text-sm text-gray-600",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded-full bg-white border"})," Free"]}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded-full bg-gray-300"})," Booked"]}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded-full bg-amber-300"})," Manual lock"]}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded-full bg-purple-300"})," Recurring lock"]})]})]})}),(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Start date",(0,s.jsx)("input",{type:"date",className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm",value:j,onChange:e=>w(e.target.value)})]}),(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Days",(0,s.jsx)("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:k,onChange:e=>N(Number(e.target.value)||y),children:o.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Timezone",(0,s.jsx)("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:S,onChange:e=>C(e.target.value),children:i.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsx)(l.z,{type:"button",variant:"outline",onClick:H,disabled:z,children:z?"Refreshing…":"Refresh"})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 xl:grid-cols-7 gap-3 min-w-full",children:Z.map(e=>{var t;let{key:r,date:a}=e;return(0,s.jsxs)("div",{className:"rounded-2xl border border-gray-100 bg-white shadow-sm",children:[(0,s.jsx)("div",{className:"border-b border-gray-100 px-4 py-3",children:(0,s.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:x(a)})}),(0,s.jsx)("div",{className:"max-h-[480px] overflow-y-auto divide-y divide-gray-100",children:null===(t=U[r])||void 0===t?void 0:t.sort((e,t)=>new Date(e.start).getTime()-new Date(t.start).getTime()).map(e=>{let t=new Date(e.start),r=new Date(e.end),a=D.includes(e.id),l=R.includes(e.id);return(0,s.jsxs)("button",{type:"button",onClick:()=>K(e),className:(0,n.cn)("w-full text-left px-4 py-3 text-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","booked"===e.status&&"bg-gray-100 text-gray-400 cursor-not-allowed","locked"===e.status&&"recurring"!==e.lockType&&"bg-amber-50 text-amber-700","locked"===e.status&&"recurring"===e.lockType&&"bg-purple-50 text-purple-700 cursor-not-allowed","available"===e.status&&"hover:bg-soft-blue-light/30 text-gray-800",a&&"ring-2 ring-soft-blue bg-soft-blue/20",l&&"ring-2 ring-amber-500"),disabled:"booked"===e.status||"recurring"===e.lockType,children:[(0,s.jsxs)("p",{className:"font-medium",children:[g(t,S)," – ",g(r,S)]}),(0,s.jsx)("p",{className:"text-xs text-gray-600 capitalize",children:"locked"===e.status?"recurring"===e.lockType?"Recurring lock":"Locked":e.status}),e.lockNote&&(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.lockNote})]},e.id)})})]},r)})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-4 rounded-3xl border border-white/70 bg-white/90 p-5 shadow-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:"Ready to lock"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:X.length||"None selected"}),(0,s.jsx)("div",{className:"mt-2 max-h-32 overflow-y-auto space-y-1 text-sm text-gray-700",children:X.map(e=>(0,s.jsxs)("p",{children:[x(new Date(e.start))," \xb7 ",g(new Date(e.start),S)]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:"Ready to unlock"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:ee.length||"None selected"}),(0,s.jsx)("div",{className:"mt-2 max-h-32 overflow-y-auto space-y-1 text-sm text-gray-700",children:ee.map(e=>(0,s.jsxs)("p",{children:[x(new Date(e.start))," \xb7 ",g(new Date(e.start),S)]},e.id))})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Internal note (optional)",(0,s.jsx)("textarea",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm",rows:3,placeholder:"Blocked for exam week, travel, etc.",value:M,onChange:e=>T(e.target.value)})]})}),E&&(0,s.jsx)("div",{className:(0,n.cn)("rounded-xl px-3 py-2 text-sm","error"===E.type?"bg-red-50 text-red-600":"bg-green-50 text-green-700"),children:E.message}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l.z,{type:"button",className:"w-full rounded-2xl bg-soft-blue text-white",disabled:"lock"===B||!X.length,onClick:()=>Q("lock",D),children:"lock"===B?"Locking…":"Lock selected slots"}),(0,s.jsx)(l.z,{type:"button",variant:"outline",className:"w-full rounded-2xl border-amber-500 text-amber-600",disabled:"unlock"===B||!ee.length,onClick:()=>Q("unlock",R),children:"unlock"===B?"Unlocking…":"Unlock selected slots"})]})]}),(0,s.jsxs)("div",{className:"space-y-4 rounded-3xl border border-white/70 bg-white/90 p-5 shadow-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:"Weekly locks"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Automatically repeat blocks (e.g. Thursdays 19:00–20:00)."})]}),(0,s.jsxs)("form",{className:"space-y-3",onSubmit:et,children:[(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Weekday",(0,s.jsx)("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:V.weekday,onChange:e=>J(t=>({...t,weekday:Number(e.target.value)||0})),children:c.map((e,t)=>(0,s.jsx)("option",{value:t,children:e},e))})]}),(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Start time",(0,s.jsx)("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:V.startMinutes,onChange:e=>{let t=Number(e.target.value);J(e=>{let r={...e,startMinutes:t};return r.startMinutes+r.durationMinutes>1320&&(r.durationMinutes=30),r})},children:u.map(e=>(0,s.jsx)("option",{value:e,children:p(e)},e))})]}),(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Duration",(0,s.jsx)("select",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm bg-white",value:V.durationMinutes,onChange:e=>J(t=>({...t,durationMinutes:Number(e.target.value)||30})),children:Y.map(e=>(0,s.jsxs)("option",{value:e,children:[e," min (",f(V.startMinutes,e),")"]},e))})]}),(0,s.jsxs)("label",{className:"text-sm font-medium text-gray-700",children:["Internal note (optional)",(0,s.jsx)("textarea",{className:"mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm",rows:2,placeholder:"Blocked for lessons, commute, etc.",value:V.note,onChange:e=>J(t=>({...t,note:e.target.value}))})]}),(0,s.jsx)(l.z,{type:"submit",className:"w-full rounded-2xl bg-soft-blue text-white",disabled:I,children:I?"Saving…":"Save weekly lock"})]}),(0,s.jsx)("div",{className:"space-y-2 max-h-56 overflow-y-auto",children:0===q.length?(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"No recurring locks yet."}):q.map(e=>(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3 rounded-2xl border border-gray-100 px-3 py-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm font-semibold text-gray-900",children:[c[e.weekday]," \xb7 ",f(e.startMinutes,e.durationMinutes)]}),e.note&&(0,s.jsx)("p",{className:"text-xs text-gray-600",children:e.note})]}),(0,s.jsx)(l.z,{type:"button",variant:"outline",size:"sm",className:"rounded-xl border-gray-200 text-gray-700",onClick:()=>er(e.id),disabled:I,children:"Remove"})]},e.id))})]})]})]})]})}},2869:function(e,t,r){"use strict";r.d(t,{z:function(){return d}});var s=r(7437),a=r(2265),l=r(5293),n=r(535),i=r(4508);let o=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,asChild:d=!1,...c}=e,u=d?l.g7:"button";return(0,s.jsx)(u,{className:(0,i.cn)(o({variant:a,size:n,className:r})),ref:t,...c})});d.displayName="Button"},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return l}});var s=r(1994),a=r(3335);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}},5293:function(e,t,r){"use strict";r.d(t,{g7:function(){return c}});var s=r(2265),a=r.t(s,2);function l(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}var n=r(7437),i=Symbol.for("react.lazy"),o=a[" use ".trim().toString()];function d(e){var t;return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===i&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t}var c=function(e){let t=function(e){let t=s.forwardRef((e,t)=>{let{children:r,...a}=e;if(d(r)&&"function"==typeof o&&(r=o(r._payload)),s.isValidElement(r)){var n;let e,i;let o=(n=r,(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?n.props.ref:n.props.ref||n.ref),d=function(e,t){let r={...t};for(let s in t){let a=e[s],l=t[s];/^on[A-Z]/.test(s)?a&&l?r[s]=(...e)=>{let t=l(...e);return a(...e),t}:a&&(r[s]=a):"style"===s?r[s]={...a,...l}:"className"===s&&(r[s]=[a,l].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==s.Fragment&&(d.ref=t?function(...e){return t=>{let r=!1,s=e.map(e=>{let s=l(e,t);return r||"function"!=typeof s||(r=!0),s});if(r)return()=>{for(let t=0;t<s.length;t++){let r=s[t];"function"==typeof r?r():l(e[t],null)}}}}(t,o):o),s.cloneElement(r,d)}return s.Children.count(r)>1?s.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=s.forwardRef((e,r)=>{let{children:a,...l}=e;d(a)&&"function"==typeof o&&(a=o(a._payload));let i=s.Children.toArray(a),c=i.find(m);if(c){let e=c.props.children,a=i.map(t=>t!==c?t:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,n.jsx)(t,{...l,ref:r,children:s.isValidElement(e)?s.cloneElement(e,void 0,a):null})}return(0,n.jsx)(t,{...l,ref:r,children:a})});return r.displayName=`${e}.Slot`,r}("Slot"),u=Symbol("radix.slottable");function m(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===u}},535:function(e,t,r){"use strict";r.d(t,{j:function(){return n}});var s=r(1994);let a=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=s.W,n=(e,t)=>r=>{var s;if((null==t?void 0:t.variants)==null)return l(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:n,defaultVariants:i}=t,o=Object.keys(n).map(e=>{let t=null==r?void 0:r[e],s=null==i?void 0:i[e];if(null===t)return null;let l=a(t)||a(s);return n[e][l]}),d=r&&Object.entries(r).reduce((e,t)=>{let[r,s]=t;return void 0===s||(e[r]=s),e},{});return l(e,o,null==t?void 0:null===(s=t.compoundVariants)||void 0===s?void 0:s.reduce((e,t)=>{let{class:r,className:s,...a}=t;return Object.entries(a).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...i,...d}[t]):({...i,...d})[t]===r})?[...e,r,s]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[137,971,117,744],function(){return e(e.s=4341)}),_N_E=e.O()}]);